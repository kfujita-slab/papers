\chapter{背景と目的}
内視鏡操作をロボットで行うにあたり、画角調節のため対象物体である胆嚢周辺部位の
判別が必要となる。本プロジェクトでは、ニューラルネットワークを用いた
セグメンテーションシステムによってこれを実現する。
しかし、一般的にニューラルネットワークは学習に
多量のデータセットを必要とするのに対し、
医用画像はその特殊性
\footnote{情報セキュリティやデータ提供に関わる負担などの観点からガイドライン\cite{guide}に沿った適切な取得・運用が求められることに加え、教師データの作成は専門の医師による手作業で行われることが多い。}
からデータセットが少ないという問題点がある。

本章では、このような問題を抱える医用画像解析の分野において、
機械学習を用いて一定の成果を納めた研究事例を挙げるとともに、
実装済みのシステムとプロジェクトの現状、
それらを踏まえた本論文における研究目的について述べる。

\section{関連研究}
U-Net\cite{U-Net}は、医用画像セグメンテーション用として提案され、
2015年のISBI (IEEE International Symposium on Biomedical Imaging)で
Dental X-Ray Image Segmentation ChallengeとCell Tracking Challengeの
2部門で優勝するなど、高い評価を得ているセマンティックセグメンテーション手法である。
画像のダウンサンプリング(低解像度化)に対して、アップサンプリング(高解像度化)
を行うのは他のセグメンテーション手法でも見られるが、
U-Netの特徴はアップサンプリング時にダウンサンプリング前のデータを連結
することにある。この連結はスキップ接続と呼ばれ、
データが伝搬する過程で詳細な情報が失われてしまい、
セグメンテーション結果が粗くなる(粗大化する)のを防ぐ効果を持つ。
図\ref{fig:U-Net}にネットワーク構造を示す。
\begin{figure}[hbt]
    \centering
    \includegraphics[width=0.7\textwidth,clip]{image/U-Net.png}
    \caption{U-Netネットワーク構造 : \cite{U-Net}より引用}
    \label{fig:U-Net}
\end{figure}
ただし、U-Netはネットワークサイズが大きいことから、少ないデータセットでは
訓練データを丸暗記してしまう過学習を引き起こす可能性が高い。

国立研究開発法人国立がん研究センターと日本電気株式会社は、深層学習を用い、
大腸がん及び前がん病変を内視鏡検査時にリアルタイムに発見する
システム\cite{cancer}の開発に成功した。
このシステムは、内視鏡医師によってアノテーション(教師データとなるようにラベリング)
された約5000例の内視鏡画像を教師データとして学習が行われる。
約5000例という値は一般的な深層学習の教師データとしては少ないながらも、
98％という高い認識率と約30fps\ (frames per second)の高速処理を実現している。
%本プロジェクトで実装されているシステムは、この研究事例の手法から着想を得ている。
\section{プロジェクトの現状}
本プロジェクトでは、
GPUによる
ニューラルネットワークを用いたセグメンテーションシステムが
実装されており、評価用データを用いた実験では
正答率61.2％、約50fpsの性能を達成した\cite{segment}。

このシステムのロボット機構を含めた検証実験としてブタの生体を用いた動作テストを行った。
ブタは形態学的、生理学的にヒトとの類似性が高いことが知られており、
医学、免疫学、再生医療などの分野において広範囲に利用されている。
検証実験の結果、セグメンテーションシステム自体の精度向上の他に、
以下のような機能の必要性が見出された。
\begin{itemize}
\item ブタとヒトの差異にシステムを対応させるための前処理
\item 手術補助としてのセグメンテーション結果のオーバーレイ
\end{itemize}

%前者は主に実験段階で必要と考えられる。ブタとヒトの臓器では色彩や表面の
%テクスチャなどに差異があり、
%たとえブタによる実験が成功したとしても、
%実際にヒトに適用する際の信頼性に疑問が残る。
ブタはヒトとの類似性が比較的高いものの、臓器表面の色彩やテクスチャに
おいて多少の差異が存在するため、ヒトのデータセットによって
学習された当システムの検証対象としては適切ではない可能性がある。
しかしながら、新たにブタのデータセットを十分に用意するのは難しく、
たとえ用意できたとしてもそれはブタに適応したシステムとなってしまう。
そこで、カメラからの
動画像にブタの臓器画像をヒトのそれに近づける前処理を追加する予定である。
これにより、ブタを用いた検証実験によって当システムのヒトへの有効性を
正しく評価することを狙う。
後者は執刀医に対する手術補助を意図して、内視鏡映像にセグメンテーション結果
をオーバーレイするものである。

このような操作が現在のシステムに追加された場合、
その分の処理時間が増加し、
現在の実装ではリアルタイム性が失われる可能性がある。
そこで、実装されているセグメンテーションシステムを
より高速にし、かつ処理の追加にも適した実装とすることで、
%そこで、追加の画像処理をパイプライン処理を用いることで
%追加分のレイテンシ増加のみでの実装が期待できるハードウェア実装によって、
当システムのリアルタイム性を維持できるようにする必要がある。

\section{研究目的}
%本研究は、胆嚢周辺動画像のセマンティックセグメンテーションシステムを
%FPGA上に実装し、ハードウェア化による高速化と演算精度低下による
%5出力結果の誤差を検証することを目的とする。
本研究は、現在GPUを用いて実装されている胆嚢周辺画像の
セマンティックセグメンテーションの高速化手法として、
FPGAによるシステムのハードウェア化を提案し、それによる演算速度の変化を
検証することを目的とする。

畳み込みニューラルネットワークは、推論、学習ともに並列性の高い大量の
積和演算を行うことから、一般的にはGPUによる処理が行われることが多い。
%しかしながら、ハードウェアにおける動画像における畳み込み処理、
%いわゆるフィルタ演算に関しては、並列化に加えパイプラインによる恩恵が大きく、
%計算分野によってはGPUよりも高速に動作することが知られている。
しかしながら、動画像を対象とした畳み込み処理においては、
単純な並列化に加えてパイプライン化による恩恵が大きく、
計算分野によっては、FPGA等によるハードウェア処理のほうが
GPUよりも高速に動作することが知られている\cite{tsunami}。
処理の追加に関しても、
%パイプラインが維持できる構成であるならば
%追加分のレイテンシ増加のみによる実装が可能であり、適した手法と言える。
パイプラインで処理できるものならば、レイテンシの増加のみで
スループットを維持した自然な実装が可能であり、
画像処理の追加が予定される当システムに適した手法であるといえる。

%また、GPUは単独での運用が難しく、組み込み系の機器での利用が困難であることも、
%実際の運用を想定した場合難点となる可能性がある。
また、FPGAは電力効率の観点から組み込み系機器での運用に適しており、
持ち運びのできる組み込み系機器での運用が想定される
当システムにおいては大きな利点となる。
そこで本研究では、広範な機器で利用でき、電力効率にも優れたシステムを
構築可能でありながら、より高速な動作が見込めるFPGAを利用する。
%関連論文\cite{sample}.
%
%図の参照、図\ref{fig:yoshiki}
%
%表の参照、表\ref{tab:sample}
%
%\begin{figure}[hbt]
%    \centering
%    \includegraphics[scale=1.0,clip]{image/yoshiki_nico.jpg}
%    \caption{Sample図}
%    \label{fig:yoshiki}
%\end{figure}
%
%
%\begin{table}[hbt]
%    \caption{Sample表}
%    \centering
%    \begin{tabular}{|c||c|c|c|c|c|}
%        \hline
%        & XXX & XX & XXXXX & XXXX & XXXX\\
%        \hline\hline
%        XXXX     & xxx & xxx & xxxx & xx & xx \\\hline
%        XXXXX & xxx & xxx & xxxx & xx & xx \\\hline   
%    \end{tabular}
%    \label{tab:sample}
%\end{table}
%
%
%
%
%
%
